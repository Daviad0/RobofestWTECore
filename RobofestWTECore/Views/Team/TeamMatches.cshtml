@model List<RobofestWTE.Models.TeamMatch>

<h1>Team Matches</h1>
<div>
    <input type="button" class="btn btn-success" id="listallteams" value="Save Changes" />
    <input type="button" class="btn btn-danger" id="discardchanges" value="Discard Changes" />
    <a class="btn btn-warning" href="@Url.Action("TeamMatchesEdit", "Team")">Edit Match Status</a>
</div>
<br />
@{ int i = 0;}
@foreach (var match in Model.OrderBy(m => m.MatchID).ThenBy(m => m.Order))
        {
            i++;
            string idtoinput = i.ToString() + "-" + match.Order;
            string idtoinputbutton = i.ToString() + "-" + match.Order + "-add";
            string idtoinputteam = i.ToString() + "-" + match.Order + "-team";
            string idtoinputbuttonremove = i.ToString() + "-" + match.Order + "-remove";
            string idtoinputround = i.ToString() + "-" + match.Order + "-round";
            string idtoinputcompleted = i.ToString() + "-" + match.Order + "-completed";
            string idtoinputrerun = i.ToString() + "-" + match.Order + "-rerun";
            string idtoinputtestmatch = i.ToString() + "-" + match.Order + "-testmatch";
<div style="background-color:lightgray;border-radius:6px;border:10px solid lightgray;z-index:-1;margin-bottom:10px;" id="@idtoinput" class="matchentry">
    <input type="text" class="teamentry input-sm" value="@match.TeamNumber" maxlength="7" placeholder="Team Number" id="@idtoinputteam" />
    <input type="button" class="btn addafter" id="@idtoinputbutton" value="Add Another Below" />
    <input type="button" class="btn removeentry" id="@idtoinputbuttonremove" value="Delete This Entry" />
    <label for="@idtoinputround">Round #</label>
    <input type="number" class="input-sm" value="@match.RoundNum" id="@idtoinputround" placeholder="Round #" max="2" min="1" />
    @if (match.Completed == true)
    {
        <span class="badge badge-pill">Completed</span>
    }
    else if (match.Completed == false)
    {
        <span class="badge badge-pill" style="background-color:darkorange">Not Completed</span>
    }
    @if (match.Test == true)
    {
        <span class="badge badge-pill" style="border: 2px solid deeppink;background-color:lightgray;color:deeppink">Test Match</span>
    }
    @if (match.Rerun == true)
    {
        <span class="badge badge-pill" style="background-color:forestgreen">Rerun</span>
    }
    <input type="checkbox" class="checkbox" id="@idtoinputrerun" />
    <label for="@idtoinputrerun">Rerun</label>
    <input type="checkbox" class="checkbox" id="@idtoinputtestmatch" />
    <label for="@idtoinputtestmatch">Test Match</label>



</div>
}
<script src="~/lib/signalr/dist/browser/signalr.js"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>
<script>
    var chat = new signalR.HubConnectionBuilder().withUrl("/scoreHub").build();
    chat.on("reloadRequired", function () {
        location.reload(true);
    });
    chat.start().then(function () {
        var scheduler = {
            "schedules" : []
        }
        $(document).on('click', '#listallteams', function () {
            var i = 0;
            chat.invoke("clearSchedule");
            $(".matchentry").each(function () {
                i += 1;
                var localid = this.id
                var schedule = {

                };
                schedule.TeamNumber = $(this).children("#" + localid + "-team").val();
                schedule.RoundNum = $(this).children("#" + localid + "-round").val();
                schedule.CompID = 1;
                schedule.Order = i;
                schedule.Rerun = $(this).children("#" + localid + "-rerun").is(":checked");
                schedule.Test = $(this).children("#" + localid + "-testmatch").is(":checked");
                schedule.Completed = false;
                scheduler.schedules.push(schedule);
                completedschedule = JSON.stringify(schedule);
                chat.invoke("changeMatches", completedschedule);
            });
            
        });
        $(document).on('click', '.addafter', function () {
            var clearedstring = this.id.replace("-add", "");
            $("#" + clearedstring + "-add").attr("disabled", true)
            var newid = clearedstring.split("-")
            var newidstring = newid[0] + "-" + (parseInt(newid[1]) + 1)
            $("<div style='background-color:lightgray;border-radius:6px;border:10px solid lightgray;z-index:-1;margin-bottom:10px' id='" + newidstring + "' class='matchentry'><input type='text' class='teamentry input-sm' value='EMPTY' maxlength='7' placeholder='Team Number' id='" + newidstring + "-team' style='margin-right:4px'/><input type='button' class='btn addafter' id='" + newidstring + "-add' value='Add Another Below' style='margin-right:4px'/><input type='button' class='btn removeentry' id='" + newidstring + "-remove' value='Delete This Entry' placeholder='Round #' style='margin-right:4px'/><label for='" + newidstring + "-round' style='margin-right:4px'>Round #</label><input type='number' class='input-sm' id='" + newidstring + "-round' value=1 max='2' min='1' style='margin-right:4px'/><span class='badge badge-pill' style='background-color:darkorange'>Not Completed</span></div>").insertAfter("#" + clearedstring)
        });
        $(document).on('click', '.removeentry', function () {
            var clearedstring = this.id.replace("-remove", "");
            $("#" + clearedstring).remove();
        });
        $("#discardchanges").on("click", function () {
            location.reload(true);
        });
        //
    
    
        
    });
</script>