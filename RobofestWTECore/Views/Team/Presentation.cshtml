@model RobofestWTE.Models.PresentationViewModel

@{
    ViewBag.Title = "Presentation";
}
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<style>
    .almostdone {
        animation-name: color;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
    }

    @@keyframes color {
        0% {
            border-bottom-color: green;
        }

        50% {
            border-bottom-color: orange;
        }
    }
</style>
<div class="jumbotron" style="text-align:center">
    <div id="stage1">
        <h2>Welcome to @Model.CompData.Location</h2>
        <h3>@Model.CompData.Date</h3>
        <table align="center">
            <thead>
                <caption style="text-align:center">Top Teams! (Total: @Model.TeamCount)</caption>
                <tr style="text-align:center;padding-right:5px;border-bottom:#000000 1px solid">
                    <th width="10%" style="text-align:left">
                        Rank
                    </th>
                    <th width="30%" style="text-align:center">
                        Team Number
                    </th>
                    <th width="30%" style="text-align:center">
                        Team Name
                    </th>
                    <th width="30%" style="text-align:center">
                        Score
                    </th>
                </tr>
            </thead>
            <tbody class="topteams">

                @{int i = 0; }
                @foreach (var item in Model.Scoreboard)
                {
                    i++;
                    if (i > 10)
                    {
                        <tr style="text-align:center;padding-left:5px">
                            <th width="10%" style="text-align:left">
                                @i
                            </th>
                            <th width="30%" style="text-align:center">
                                @item.TeamNumberBranch-@item.TeamNumberSpecific
                            </th>
                            <th width="30%" style="text-align:center">
                                @item.TeamName
                            </th>
                            <th width="30%" style="text-align:center" id="@item.TeamNumberBranch-@item.TeamNumberSpecific">
                                @item.Average
                            </th>
                        </tr>
                    }
                }
            </tbody>
        </table>


        <br />
        <table style="text-align:center;width:100%">

            <tr>
                <td class="field1s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 1</h3>
                    

                    <h4 class="field1team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field2s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 2</h3>
                    

                    <h4 class="field2team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field3s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 3</h3>
                    

                    <h4 class="field3team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field4s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 4</h3>
                    

                    <h4 class="field4team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field5s" style="background-color: lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 5</h3>
                    

                    <h4 class="field5team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field6s" style="background-color: lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 6</h3>
                    

                    <h4 class="field6team" style="font-family:'Lucida Console'">No Team</h4>
                </td>

            </tr>
            <tr>
                <td style="padding-top: 10px ">
                    <span class="field1connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field2connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field3connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field4connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field5connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field6connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>

            </tr>
        </table>
        <h5 style="text-align:center;font-family:'Lucida Console'" class="lastupdated">* All Fields Deinitialized</h5>
        <h5 style="text-align:center;font-family:'Lucida Console';color:red" id="gamestatus"></h5>
        <span id="ping"></span>


    </div>
    <div id="stage2">
        <div class="status" style="border-bottom:gray 12px solid;border-radius:4px;display:inline-block">
            <h1 style="font-family:'Lucida Console';background-color:black;padding:10px;padding-bottom:0px;border-radius:4px 4px 0px 0px;color:white;margin-bottom:0px" class="timerarea"><span id="minutes" class="timerarea minutes">0</span>:<span id="seconds" class="timerarea seconds">00</span></h1>
        </div>
        <span style="font-family:'Lucida Console'"><span class="message"></span></span>
        <br />
        <br />
        <table style="text-align:center;width:100%">

            <tr>
                <td class="field1st" style="background-color:lightgray">
                    <h3 style="font-family:'Lucida Console'">Field 1</h3>
                    <h2 class="field1score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field1team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field2st" style="background-color:lightgray">
                    <h3 style="font-family:'Lucida Console'">Field 2</h3>

                    <h2 class="field2score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field2team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field3st" style="background-color:lightgray">
                    <h3 style="font-family:'Lucida Console'">Field 3</h3>

                    <h2 class="field3score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field3team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field4st" style="background-color:lightgray">
                    <h3 style="font-family:'Lucida Console'">Field 4</h3>

                    <h2 class="field4score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field4team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field5st" style="background-color:lightgray">
                    <h3 style="font-family:'Lucida Console'">Field 5</h3>

                    <h2 class="field5score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field5team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field6st" style="background-color:lightgray">
                    <h3 style="font-family:'Lucida Console'">Field 6</h3>

                    <h2 class="field6score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field6team" style="font-family:'Lucida Console'">No Team</h4>
                </td>

            </tr>
        </table>
    </div>
    <div id="stage3">
        <table align="center">
            <thead>
                <caption style="text-align:center">Top Teams! (Total: @Model.TeamCount)</caption>
                <tr style="text-align:center;padding-right:5px;border-bottom:#000000 1px solid">
                    <th width="10%" style="text-align:left">
                        Rank
                    </th>
                    <th width="30%" style="text-align:center">
                        Team Number
                    </th>
                    <th width="30%" style="text-align:center">
                        Team Name
                    </th>
                    <th width="30%" style="text-align:center">
                        Score
                    </th>
                </tr>
            </thead>
            <tbody class="topteams">

                @{i = 0; }
                @foreach (var item in Model.Scoreboard)
                {
                    i++;
                    <tr style="text-align:center;padding-left:5px">
                        <th width="10%" style="text-align:left">
                            @i
                        </th>
                        <th width="30%" style="text-align:center">
                            @item.TeamNumberBranch-@item.TeamNumberSpecific
                        </th>
                        <th width="30%" style="text-align:center">
                            @item.TeamName
                        </th>
                        <th width="30%" style="text-align:center" id="@item.TeamNumberBranch-@item.TeamNumberSpecific">
                            @item.Average
                        </th>
                    </tr>
                }
            </tbody>
        </table>
        <br />
        <table style="text-align:center;width:100%">

            <tr>
                <td class="field1s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 1</h3>
                    

                    <h2 class="field1score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field1team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field2s" style="background-color:lightgray;border-top: gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 2</h3>
                    

                    <h2 class="field2score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field2team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field3s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 3</h3>
                    

                    <h2 class="field3score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field3team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field4s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 4</h3>
                    

                    <h2 class="field4score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field4team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field5s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family: 'Lucida Console'">Field 5</h3>
                    

                    <h2 class="field5score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field5team" style="font-family:'Lucida Console'">No Team</h4>
                </td>
                <td class="field6s" style="background-color:lightgray;border-top:gray 12px solid">
                    <h3 style="font-family:'Lucida Console'">Field 6</h3>
                    

                    <h2 class="field6score" style="font-family:'Lucida Console'">--</h2>
                    <h4 class="field6team" style="font-family:'Lucida Console'">No Team</h4>
                </td>

            </tr>
            <tr>
                <td style="padding-top:10px">
                    <span class="field1connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field2connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field3connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field4connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field5connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>
                <td style="padding-top:10px">
                    <span class="field6connection" style="background-color:lightgray;padding:2px 5px 2px 5px;color:white;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Off</span>
                </td>

            </tr>
        </table>
        <h5 style="text-align:center;font-family:'Lucida Console'" class="lastupdated">* All Fields Deinitialized</h5>
    </div>
    <div id="stage4">
        <div class="status" style="border-bottom:gray 12px solid;border-radius:4px;display:inline-block">
            <h1 style="font-family:'Lucida Console';background-color:black;padding:10px;padding-bottom:0px;border-radius:4px 4px 0px 0px;color:white;margin-bottom:0px" class="timerarea"><span id="minutes" class="timerarea minutes">0</span>:<span id="seconds" class="timerarea seconds">00</span></h1>
        </div>
        <h3 style="font-family:'Lucida Console'"><span class="message"></span></h3>
        <br />
        <div id="myCarousel" class="carousel slide">

            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
                <div class="item active">
                    <table align="center">
                        <thead>
                            <caption style="text-align:center">Top Teams! (Total: @Model.TeamCount)</caption>
                            <tr style="text-align:center;padding-right:5px;border-bottom:#000000 1px solid">
                                <th width="10%" style="text-align:left">
                                    Rank
                                </th>
                                <th width="30%" style="text-align:center">
                                    Team Number
                                </th>
                                <th width="30%" style="text-align:center">
                                    Team Name
                                </th>
                                <th width="30%" style="text-align:center">
                                    Score
                                </th>
                            </tr>
                        </thead>
                        <tbody class="topteams">

                            @{i = 0; }
                            @foreach (var item in Model.Scoreboard)
                            {
                                i++;
                                <tr style="text-align:center;padding-left:5px">
                                    <th width="10%" style="text-align:left">
                                        @i
                                    </th>
                                    <th width="30%" style="text-align:center">
                                        @item.TeamNumberBranch-@item.TeamNumberSpecific
                                    </th>
                                    <th width="30%" style="text-align:center">
                                        @item.TeamName
                                    </th>
                                    <th width="30%" style="text-align:center" id="@item.TeamNumberBranch-@item.TeamNumberSpecific">
                                        @item.Average
                                    </th>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="item">
                    <h2>Thanks for coming!</h2>
                </div>

                <div class="item">
                    <h2>2020 Challenge: GolfBowl</h2>
                    <h3>Hit golf balls into a hole and try to knock down pins!</h3>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/lib/signalr/dist/browser/signalr.js"></script>
<script src="~/lib/jquery/dist/jquery.js"></script>

<script>
    var myIndex = 0;
    $(document).ready(function () {
        // Activate Carousel
        carousel();
        $("#stage2").css("display", "none")
        $("#stage3").css("display", "none")
        $("#stage4").css("display", "none")
    });
    function carousel() {
        var i;
        var x = document.getElementsByClassName("item");
        for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
        }
        myIndex++;
        if (myIndex > x.length) { myIndex = 1 }
        x[myIndex - 1].style.display = "block";
        setTimeout(carousel, 5000);
    }
</script>
<script>
    $(function () {
        var timer = false;
        var minutesc = 0;
        var secondsc = 0;
        var secondsview = "00";
        var interval = false;
        var allseconds = 0;
        var part = 0;
        var fieldarray = [0, 0, 0, 0, 0, 0];
        var fieldconnected = [false, false, false, false, false, false]
        var initsec = 0;
        // Reference the auto-generated proxy for the hub.
        var chat = new signalR.HubConnectionBuilder().withUrl("/scoreHub").build();
        // Create a function that the hub can call back to display messages.
        chat.on("changeTeamScores", function (topten) {
            // Add the message to the page.
            //$('#' + teamnumber).text(score);
            $(".topteams").empty();

            $.each(topten, function (index, value) {
                var markup = "<tr style='text-align:center;padding-left:5px'><th width='10%' style='text-align:left'>" + (index + 1) +
                    "</th><th width='30%' style='text-align:center'>" + value.TeamNumberBranch + "-" + value.TeamNumberSpecific + "</th><th width='30%' style='text-align:center'>" +
                    value.TeamName + "</th><th width='30%' style='text-align:center'>" +
                    value.Average + "</th></tr>";
                $(".topteams").append(markup);
            });
        });

        chat.on("changeStage", function (stage) {
            $("#stage" + 1).css("display", "none");
            $("#stage" + 2).css("display", "none");
            $("#stage" + 3).css("display", "none");
            $("#stage" + 4).css("display", "none");
            $("#stage" + stage).css("display", "");
        });
        chat.on("changeGlobalTimer", function (minutes, seconds, message, status) {
            $(".minutes").html(minutes);
            if (seconds < 10) {
                secondsview = "0" + seconds;
            } else {
                secondsview = seconds;
            }
            $(".seconds").html(secondsview);
            $(".message").html(message);
            if (status == 0) {
                $(".status").css("border-bottom", "12px gray solid");
                $(".status").removeClass("almostdone");
                initsec = ((minutes * 60) + (seconds)) / 4;
            } else if (status == 1) {
                $(".status").css("border-bottom", "12px green solid");
                if (((minutes * 60) + (seconds)) < initsec) {
                    $(".status").addClass("almostdone");
                }
            } else if (status == 2 && seconds < 1 && minutes < 1) {
                $(".status").css("border-bottom", "12px red solid");
                $(".status").removeClass("almostdone");
            } else {
                $(".status").css("border-bottom", "12px gray solid");
                $(".status").removeClass("almostdone");
            }
        });
        chat.on("initFieldView", function (field, status, score, team, connection, matchkeeper) {
            if (status == 0) {
                $(".field" + field + "s").css("border-top", "gray 12px solid");
                $(".field" + field + "team").html("No Team");
                $(".lastupdated").html("* Field " + field + " deinitialized!")
                $(".field" + field + "score").html("--");
                fieldarray[field - 1] = 0;
            } else if (status == 1) {
                $(".field" + field + "s").css("border-top", "tomato 12px solid");

                if (team != "") {
                    $(".field" + field + "team").html(team);
                } else {
                    $(".field" + field + "team").html("No Team");
                }

                $(".lastupdated").html("* Field " + field + " not ready!");
                fieldarray[field - 1] = 1;
            } else if (status == 2) {
                $(".field" + field + "s").css("border-top", "MediumSeaGreen 12px solid");
                $(".lastupdated").html("* Field " + field + " ready!");
                if (team != "") {
                    $(".field" + field + "team").html(team);
                } else {
                    $(".field" + field + "team").html("No Team");
                }
                fieldarray[field - 1] = 2;
            } else if (status == 3) {
                $(".field" + field + "s").css("border-top", "dodgerblue 12px solid");
                $(".lastupdated").html("* Field " + field + " has submitted final scores!");
                if (team != "") {
                    $(".field" + field + "team").html(team);
                } else {
                    $(".field" + field + "team").html("No Team");
                }
                fieldarray[field - 1] = 3;
            } else if (status == 5) {
                if (fieldarray[field - 1] != 0) {
                    $(".field" + field + "score").html(score);
                }
                if (team != "") {
                    $(".field" + field + "team").html(team);
                } else {
                    $(".field" + field + "team").html("No Team");
                }
            }
            if (fieldarray.includes(1) == true) {
                $("#gamestatus").html("Not All Ready!");
            } else {
                $("#gamestatus").html("");
            }
            if (status == 0) {
                $(".field" + field + "connection").html("Off");
                $(".field" + field + "connection").css("background-color", "lightgray");
            } else {
                if (connection == true) {
                    $(".field" + field + "connection").html("LIVE");
                    $(".field" + field + "connection").css("background-color", "red");
                }
                else {
                    $(".field" + field + "connection").html("Paused");
                    $(".field" + field + "connection").css("background-color", "gray");
                }

            }
        });
        chat.on("updateLive", function (field) {
            if (field < 7 && field > 0) {
                fieldconnected[field - 1] = true;
            }
        });
        // Start the connection.
        chat.start().then(function () {
            function checkPongs() {
                if (fieldconnected[0] == true) {
                    if (fieldarray[0] != 0 && fieldarray != 3) {
                        $("#field1lc").html("C");
                    }
                } else {
                    $("#field1lc").html("NC");
                }
                if (fieldconnected[1] == true) {
                    if (fieldarray[1] != 0 && fieldarray != 3) {
                        $("#field2lc").html("C");
                    }
                } else {
                    $("#field2lc").html("NC");
                }
                if (fieldconnected[2] == true) {
                    if (fieldarray[2] != 0 && fieldarray != 3) {
                        $("#field3lc").html("C");
                    }
                } else {
                    $("#field3lc").html("NC");
                }
                if (fieldconnected[3] == true) {
                    if (fieldarray[3] != 0 && fieldarray != 3) {
                        $("#field4lc").html("C");
                    }
                } else {
                    $("#field4lc").html("NC");
                }
                if (fieldconnected[4] == true) {
                    if (fieldarray[4] != 0 && fieldarray != 3) {
                        $("#field5lc").html("C");
                    }
                } else {
                    $("#field5lc").html("NC");
                }
                if (fieldconnected[5] == true) {
                    if (fieldarray[5] != 0 && fieldarray != 3) {
                        $("#field6lc").html("C");
                    }
                } else {
                    $("#field6lc").html("NC");
                }
                fieldconnected = [false, false, false, false, false, false]
                $("#ping").html("2");
                setTimeout(pingTeams, 1000);
            }
            function pingTeams() {
                $("#ping").html("1");
                chat.invoke("pingField", 7);
                setTimeout(checkPongs, 5000);

            }
            setTimeout(pingTeams, 1000);
        });




    });


</script>